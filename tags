trigger:
  branches:
    include:
      - develop

stages:
  - stage: CreateTag
    displayName: "Create Git Tag"
    jobs:
      - job: CreateTagJob
        displayName: "Create and Push Git Tag"
        pool:
          vmImage: 'ubuntu-latest'

        steps:
          # Step 1: Check out the code
          - task: Checkout@1

          # Step 2: Read tag and comment from tag.txt
          - script: |
              TAG_NAME=$(sed -n '1p' tag.txt)
              TAG_COMMENT=$(sed -n '2p' tag.txt)

              if [[ -z "$TAG_NAME" || -z "$TAG_COMMENT" ]]; then
                echo "Error: Tag name or comment is missing in tag.txt."
                exit 1
              fi

              echo "##vso[task.setvariable variable=TAG_NAME]$TAG_NAME"
              echo "##vso[task.setvariable variable=TAG_COMMENT]$TAG_COMMENT"
            displayName: "Read tag and comment"

          # Step 3: Set up Git for tagging
          - script: |
              git config user.name "Your Name"
              git config user.email "your-email@example.com"
            displayName: "Set up Git"

          # Step 4: Create the tag
          - script: |
              git tag -a "$TAG_NAME" -m "$TAG_COMMENT"
            displayName: "Create Git Tag"

          # Step 5: Push the tag to the remote repository
          - script: |
              git push origin "$TAG_NAME"
            displayName: "Push Git Tag"
